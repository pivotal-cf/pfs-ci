resources:

- name: git-riff
  type: git
  source:
    uri: https://github.com/projectriff/riff.git
    branch: master

- name: topic-controller-version
  type: semver
  source:
    driver: gcs
    bucket: riff_versions
    key: topic-controller-version
    json_key: ((gcp-json-key))

- name:  topic-controller-image
  type: docker-image
  source:
    repository: ((docker-test-org))/topic-controller-image
    username: ((docker-riff-username))
    password: ((docker-riff-password))


jobs: ####################################################################################################

- name: build-component-images
  plan:
  - aggregate:
    - get: git-riff
    - get: topic-controller-version
  - put: topic-controller-image
    params:
      build: git-riff
      build_args:
        COMPONENT: topic-controller
      tag: topic-controller-version/version

########


resources:

- name: git-riff
  type: git
  source:
    uri: https://github.com/projectriff/riff.git
    branch: master

- name: riff-version
  type: semver
  source:
    driver: gcs
    bucket: riff_versions
    key: topic-controller-version
    json_key: ((gcp-json-key))

- name:  topic-controller-image
  type: docker-image
  source:
    repository: ((docker-test-org))/topic-controller-image
    username: ((docker-riff-username))
    password: ((docker-riff-password))


jobs: ####################################################################################################

- name: build-component-images
  plan:
  - aggregate:
    - get: git-riff
    - get: riff-version
  - aggregate:
    - put: topic-controller-docker-image
      params:
        build: git-riff
        tag: riff-version/version
        build_args:
          COMPONENT: topic-controller
    - put: function-controller-docker-image
      params:
        build: git-riff
        tag: riff-version/version
        build_args:
          COMPONENT: function-controller
    - put: function-sidecar-docker-image
      params:
        build: git-riff
        tag: riff-version/version
        build_args:
          COMPONENT: function-sidecar
    - put: http-gateway-docker-image
      params:
        build: git-riff
        tag: riff-version/version
        build_args:
          COMPONENT: http-gateway



